<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="UTF-8">
    <title>Compartir Dibuix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body>
    <div class="main-container">
        <div class="welcome-card col-11 col-md-8 col-lg-6 text-start">

            <h2 class="text-warning text-center mb-4">Compartir "<span th:text="${canvas.name}"></span>"</h2>

            <div th:if="${error}" class="alert alert-danger" role="alert">
                <span th:text="${error}"></span>
            </div>
            
            <div class="card bg-dark border-secondary mb-4">
                <div class="card-body">
                    <h5 class="card-title text-light mb-3">Afegir usuari</h5>
                    <form action="/compartir" method="post" class="row g-3 align-items-end">
                        <input type="hidden" name="canvasId" th:value="${canvas.id}">

                        <div class="col-md-6">
                            <label class="form-label text-secondary">Usuari</label>

                            <select name="username" class="form-select bg-secondary text-light border-0" required>
                                <option value="" disabled selected>Selecciona un usuari...</option>

                                <th:block th:each="u : ${availableUsers}">
                                    <option th:value="${u.username}" th:text="${u.username}"></option>
                                </th:block>
                            </select>
                        </div>

                        <div class="col-md-4">
                            <label class="form-label text-secondary">Permís</label>
                            <select name="canWrite" class="form-select bg-secondary text-light border-0">
                                <option value="false">Només Lectura</option>
                                <option value="true">Escriptura (Editar)</option>
                            </select>
                        </div>

                        <div class="col-md-2">
                            <button type="submit" class="btn btn-warning w-100">
                                <i class="bi bi-plus-lg"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <h5 class="text-light mb-3">Usuaris amb accés</h5>
            <ul class="list-group mb-4">
                <li th:each="share : ${shares}"
                    class="list-group-item bg-dark text-light border-secondary d-flex justify-content-between align-items-center">
                    <div>
                        <i class="bi bi-person-circle me-2 text-warning"></i>
                        <span th:text="${share.user.username}" class="fw-bold">Usuari</span>
                        <span class="text-secondary small ms-2"
                            th:text="${share.permission.writePermission == 'public'} ? '(Pot editar)' : '(Només lectura)'">
                        </span>
                    </div>

                    <form action="/dejar-de-compartir" method="post" style="display:inline;">
                        <input type="hidden" name="canvasId" th:value="${canvas.id}">
                        <input type="hidden" name="userId" th:value="${share.user.id}">
                        <button type="submit" class="btn btn-sm btn-outline-danger" title="Eliminar accés">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>
                </li>

                <li th:if="${#lists.isEmpty(shares)}"
                    class="list-group-item bg-dark text-secondary border-secondary text-center">
                    Aquest dibuix no es comparteix amb ningú.
                </li>
            </ul>

            <div class="text-center">
                <a href="/dibuixos" class="btn btn-outline-secondary">Tornar</a>
            </div>

        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>